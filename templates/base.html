{% load static %}
<!doctype html>
<html lang="en">
   <head>
      <!-- Required meta tags -->
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <meta name="description" content="Askbootstrap">
      <meta name="author" content="Askbootstrap">
      <title>Farg'onadagi mazzali taomlar uchun buyurtma</title>
      <!-- Favicon Icon -->
      <link rel="icon" type="image/png" href="{% static 'my_app/img/favicon.png'%}">
      <!-- Bootstrap core CSS-->
      <link href="{% static 'my_app/vendor/bootstrap/css/bootstrap.min.css'%}" rel="stylesheet">
      <!-- Font Awesome-->
      <link href="{% static 'my_app/vendor/fontawesome/css/all.min.css'%}" rel="stylesheet">
      <!-- Font Awesome-->
      <link href="{% static 'my_app/vendor/icofont/icofont.min.css'%}" rel="stylesheet">
      <!-- Select2 CSS-->
      <link href="{% static 'my_app/vendor/select2/css/select2.min.css'%}" rel="stylesheet">
      <!-- Custom styles for this template-->
      <link href="{% static 'my_app/css/osahan.css'%}" rel="stylesheet">
      <!-- Owl Carousel -->
      <link rel="stylesheet" href="{% static 'my_app/vendor/owl-carousel/owl.carousel.css'%}">
      <link rel="stylesheet" href="{% static 'my_app/vendor/owl-carousel/owl.theme.css'%}">
      <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>




   </head>
   {% if messages %}
         <div class="container">
         {% for message in messages %}
            <div class="alert alert-secondary text-dark alert-dismissible fade show" role="alert" style="background-color: bg-second;">
               <div style="text-align: center;">{{ message }}</div>
                        
                   
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
               </div>
         {% endfor %}
         </div>
   {% endif %}
   <body>
      <nav  class="navbar navbar-expand-lg navbar-light bg-light osahan-nav shadow-sm">
         <div class="container">
            <a class="navbar-brand" href="index.html"><img alt="logo" src="{% static 'my_app/img/logo.png' %}"></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
               <ul class="navbar-nav ml-auto flex align-center">
                  <li class="nav-item active">
                     <a class="nav-link" href="{% url 'index' %}">Bosh sahifa <span class="sr-only">(current)</span></a>
                  </li>
                  <li class="nav-item">
                     <a class="nav-link" href="{% url 'listing' %}"><i class="icofont-sale-discount"></i> Restoranlar <span class="badge badge-danger">New</span></a>
                  </li>
                  
                  <li class="nav-item dropdown">
                     <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                     Pages
                     </a>
                     <div class="dropdown-menu dropdown-menu-right shadow-sm border-0">
                        <a class="dropdown-item" href="{% url 'track_order' %}">Track Order</a>
                        <a class="dropdown-item" href="{% url 'error' %}">404</a>
                     </div>
                  </li>
                  <li class="nav-item dropdown">
                     <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                     <img width="30" height="30" alt="Generic placeholder image" src="{{user.image.url }}" class="nav-osahan-pic rounded-pill"> {{user.first_name }}</a>
                     </a>
                     <div class="dropdown-menu dropdown-menu-right shadow-sm border-0">
                        {% if user.is_authenticated %}
                        <a class="dropdown-item" href="orders.html#orders"><i class="icofont-food-cart"></i>Mening sahifam</a>
                        <a class="dropdown-item" href="{% url 'users:logout'%}"><i class="icofont-sale-discount"></i>Chiqish</a>
                        {% else %}
                        <a class="dropdown-item" href="{% url 'users:login'%}"><i class="icofont-heart"></i> Shaxsiy kabinet</a>
                        <a class="dropdown-item" href="{% url 'users:register'%}"><i class="icofont-credit-card"></i> Ro'yhatdan o'tish</a>
                        {% endif %}
                     </div>
                  </li>
                  <li class="nav-item dropdown dropdown-cart">
                     <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                     <i class="fas fa-heart"></i> Cart
                     <span class="badge badge-success" id="like_items">{{ request.session.liked_products|length }}</span>
                     </a>
                     <div class="dropdown-menu dropdown-cart-top p-0 dropdown-menu-right shadow-sm border-0">
                        
                        <div class="dropdown-cart-top-body border-top p-4">
                           {% for product in liked_products %}
                               <div class="mb-3">
                                   <a href="#" class="d-flex align-items-center text-decoration-none">
                                       <img src="{{ product.photo.url }}" alt="Product Image" class="img-fluid mr-3" style="max-width: 100px; height: auto;" />
                                       <div class="flex-grow-1">
                                           <h6 class="mb-0">{{ product.name }}</h6>
                                           <p class="mb-0 text-secondary">{{ product.restaurant }} </p>
                                           <p class="mb-0 text-secondary">{{ product.price }} so'm</p>
                                       </div>
                                   </a>
                               </div>
                           {% endfor %}
                       </div>
                       
                        <div class="dropdown-cart-top-footer border-top p-4">
                           <p class="mb-0 font-weight-bold text-secondary">Jami: <span class="float-right text-dark">{{total_price}} so'm</span></p>
                        </div>
                        <div class="dropdown-cart-top-footer border-top p-2">
                           <a class="btn btn-success btn-block btn-lg" href="checkout.html"> Checkout</a>
                        </div>
                     </div>
                  </li>
               </ul>
            </div>
         </div>
      </nav>
      {% block content %}
      {% endblock content%}
      <section class="footer pt-5 pb-5">
         <div class="container">
            <div class="row">
               <div class="col-md-4 col-12 col-sm-12">
                  <h6 class="mb-3">Subscribe to our Newsletter</h6>
                  <form class="newsletter-form mb-1">
                     <div class="input-group">
                        <input type="text" placeholder="Please enter your email" class="form-control">
                        <div class="input-group-append">
                           <button type="button" class="btn btn-primary">
                           Subscribe
                           </button>
                        </div>
                     </div>
                  </form>
                  <p><a class="text-info" href="register.html">Register now</a> to get updates on <a href="offers.html">Offers and Coupons</a></p>
                  <div class="app">
                     <p class="mb-2">DOWNLOAD APP</p>
                     <a href="#">
                     <img class="img-fluid" src="{% static 'my_app/img/google.png'%}">
                     </a>
                     <a href="#">
                     <img class="img-fluid" src="{% static 'my_app/img/apple.png'%}">
                     </a>
                  </div>
               </div>
               <div class="col-md-1 col-sm-6 mobile-none">
               </div>
               <div class="col-md-2 col-6 col-sm-4">
                  <h6 class="mb-3">About OE</h6>
                  <ul>
                     <li><a href="#">About Us</a></li>
                     <li><a href="#">Culture</a></li>
                     <li><a href="#">Blog</a></li>
                     <li><a href="#">Careers</a></li>
                     <li><a href="#">Contact</a></li>
                  </ul>
               </div>
               <div class="col-md-2 col-6 col-sm-4">
                  <h6 class="mb-3">For Foodies</h6>
                  <ul>
                     <li><a href="#">Community</a></li>
                     <li><a href="#">Developers</a></li>
                     <li><a href="#">Blogger Help</a></li>
                     <li><a href="#">Verified Users</a></li>
                     <li><a href="#">Code of Conduct</a></li>
                  </ul>
               </div>
               <div class="col-md-2 m-none col-4 col-sm-4">
                  <h6 class="mb-3">For Restaurants</h6>
                  <ul>
                     <li><a href="#">Advertise</a></li>
                     <li><a href="#">Add a Restaurant</a></li>
                     <li><a href="#">Claim your Listing</a></li>
                     <li><a href="#">For Businesses</a></li>
                     <li><a href="#">Owner Guidelines</a></li>
                  </ul>
               </div>
            </div>
         </div>
      </section>
      
      <footer class="pt-4 pb-4 text-center">
         <div class="container">
            <p class="mt-0 mb-0">Â© Copyright 2020 Osahan Eat. All Rights Reserved</p>
            <small class="mt-0 mb-0"> Made with <i class="fas fa-heart heart-icon text-danger"></i> by
            <a class="text-danger" target="_blank" href="https://www.instagram.com/iamgurdeeposahan/">Gurdeep Osahan</a> - <a class="text-primary" target="_blank" href="https://askbootstrap.com/">Ask Bootstrap</a>
            </small>
         </div>
      </footer>
      <!-- jQuery -->
      <script src="{% static 'my_app/vendor/jquery/jquery-3.3.1.slim.min.js'%}"></script>
      <!-- Bootstrap core JavaScript-->
      <script src="{% static 'my_app/vendor/bootstrap/js/bootstrap.bundle.min.js'%}"></script>
      <!-- Select2 JavaScript-->
      <script src="{% static 'my_app/vendor/select2/js/select2.min.js'%}"></script>
      <!-- Owl Carousel -->
      <script src="{% static 'my_app/vendor/owl-carousel/owl.carousel.js'%}"></script>
      <!-- Custom scripts for all pages-->
      <script src="{% static 'my_app/js/custom.js'%}"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      
      <script>
         $(document).on('click', '#heart', function(e) {
            e.preventDefault();
            var product_id = $(this).attr("value");
        
            $.ajax({
                type: 'POST',
                url: "{% url 'like_add' %}",
                data: {
                    product_id: product_id,
                    action: 'post',
                    csrfmiddlewaretoken: "{{ csrf_token }}"
                },
                success: function(response) {
                    if (response && response.like_count !== undefined) {
                        $('#like_items').text(response.like_count);
                    } else {
                        console.error('Failed to update like count.');
                    }
                },
                error: function(xhr, errmsg, err) {
                    console.error('Error:', errmsg);
                }
            });
        });
     </script>
   </body>
</html>